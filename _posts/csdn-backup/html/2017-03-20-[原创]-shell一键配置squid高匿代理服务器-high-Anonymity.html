---
layout: post
title: "[原创]-shell一键配置squid高匿代理服务器-high-Anonymity"
date: 2017-03-20 14:48:54
image: '/assets/img/'
description: ""
tags:
    - 
categories:
    - linux
---



<div id="sina_keyword_ad_area2" class="articalContent newfont_family"><span style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">部署了大量机器，需要做squid代理用</span><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">直接上码</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><strong># 一、<span style="line-height:1.5;">######### Local shell #########</span></strong></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"># sshpass 免于ssh首次登录远程机器需要交互输入密码的繁琐。 </div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><strong># sshpass -p <span style="color:#FF0000;line-height:21px;">SERVER_PASSWD ssh/scp params command</span></strong></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"># sshpass ：-p 远程服务器密码</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"># ssh： -o <span style="line-height:1.5;">"StrictHostKeyChecking no"   默认准许登录密钥认证</span></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><strong>sshpass -p "<span style="color:#FF0000;line-height:21px;">SERVER_PASSWD</span>" ssh -o "StrictHostKeyChecking no" -p <span style="color:#FF0000;line-height:21px;">SERVER_SSH_PORT</span> <span style="color:#FF0000;line-height:21px;">SERVER_USER</span>@<span style="color:#FF0000;line-height:21px;">SERVER_IP</span> 'curl "<span style="color:#FF0000;line-height:21px;">http://zhangzhipeng2023.cn/squid/install-squid.sh</span>" | bash'</strong></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><strong># 二、####### install-squid.sh (remote)##########</strong></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><div><span style="line-height:21px;"># 存放于：</span><span style="line-height:1.5;"><span style="color:#FF0000;line-height:21px;">http://zhangzhipeng2023.cn/squid/install-squid.sh</span></span></div><div><span style="line-height:21px;"><br /></span></div><div><span style="line-height:21px;"># 1.  静默安装squid， -y：默认yes</span></div><div><strong>yum install -y squid</strong></div><div># 2.  下载并替换本地squid配置文件， -O：文件保存路径</div><div><strong>wget -O "/etc/squid/squid.conf" "<span style="color:#FF0000;line-height:21px;">http://zhangzhipeng2023.cn/squid/squid.conf</span>"</strong></div><div># 3.  检查参数</div><div><strong>squid -k parse</strong></div><div># 4.  初始化缓存</div><div><strong>squid -z</strong></div><div># 5.  <span style="line-height:21px;">htpasswd 生成squid 代理 用户名、密码， -c：创建密码文件，-b 使用参数传递设置密码</span></div><div><strong>htpasswd -c -b /usr/lib/squid/passwd <span style="color:#FF0000;line-height:21px;">PROXY_USER</span> <span style="color:#FF0000;line-height:21px;">PROXY_PASSWD</span></strong></div><div># 6.  启动squid服务</div><div><strong>service squid restart</strong></div></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"># 7.  开机启动</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">####---</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><strong><span style="line-height:21px;"># 三、####### squid.conf(</span><span style="line-height:21px;">remote</span><span style="line-height:21px;">) ##########</span></strong></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><div>#### 存放于：<span style="line-height:1.5;"><span style="color:#FF0000;line-height:21px;">http://zhangzhipeng2023.cn/squid/squid.conf</span></span></div><div># </div><div># Recommended minimum configuration:</div><div>#</div><div>acl manager proto cache_object</div><div>acl localhost src 127.0.0.1/32 ::1</div><div>acl to_localhost dst 127.0.0.0/8 0.0.0.0/32 ::1</div><div><br /></div><div># Example rule allowing access from your local networks.</div><div># Adapt to list your (internal) IP networks from where browsing</div><div># should be allowed</div><div>acl localnet src 10.0.0.0/8     # RFC1918 possible internal network</div><div>acl localnet src 172.16.0.0/12  # RFC1918 possible internal network</div><div>acl localnet src 192.168.0.0/16 # RFC1918 possible internal network</div><div>acl localnet src fc00::/7       # RFC 4193 local private network range</div><div>acl localnet src fe80::/10      # RFC 4291 link-local (directly plugged) machines</div><div><br /></div><div>acl SSL_ports port 443</div><div>acl Safe_ports port 80          # http</div><div>acl Safe_ports port 21          # ftp</div><div>acl Safe_ports port 443         # https</div><div>acl Safe_ports port 70          # gopher</div><div>acl Safe_ports port 210         # wais</div><div>acl Safe_ports port 1025-65535  # unregistered ports</div><div>acl Safe_ports port 280         # http-mgmt</div><div>acl Safe_ports port 488         # gss-http</div><div>acl Safe_ports port 591         # filemaker</div><div>acl Safe_ports port 777         # multiling http</div><div>acl CONNECT method CONNECT</div><div><br /></div><div>#</div><div># Recommended minimum Access Permission configuration:</div><div>#</div><div># Only allow cachemgr access from localhost</div><div>http_access allow manager localhost</div><div>http_access deny manager</div><div><br /></div><div># Deny requests to certain unsafe ports</div><div>http_access deny !Safe_ports</div><div><br /></div><div># Deny CONNECT to other than secure SSL ports</div><div>http_access deny CONNECT !SSL_ports</div><div><br /></div><div># We strongly recommend the following be uncommented to protect innocent</div><div># web applications running on the proxy server who think the only</div><div># one who can access services on "localhost" is a local user</div><div>#http_access deny to_localhost</div><div><br /></div><div>#</div><div># INSERT YOUR OWN RULE(S) HERE TO ALLOW ACCESS FROM YOUR CLIENTS</div><div>#</div><div><br /></div><div># Example rule allowing access from your local networks.</div><div># Adapt localnet in the ACL section to list your (internal) IP networks</div><div># from where browsing should be allowed</div><div>http_access allow localnet</div><div>http_access allow localhost</div><div><br /></div><div># And finally deny all other access to this proxy</div><div># http_access allow all</div><div># <span style="color:#FF0000;line-height:21px;">配置：代理账号 密码，授权用户</span></div><div><div style="line-height:21px;"><strong>auth_param basic program /usr/lib/squid/ncsa_auth /usr/lib/squid/passwd</strong></div><div style="line-height:21px;"><strong>acl auth_user proxy_auth REQUIRED</strong></div><div style="line-height:21px;"><strong>http_access allow auth_user</strong></div></div><div><br /></div><div># Squid normally listens to port 3128</div><div><strong>http_port 3128</strong></div><div><br /></div><div># Uncomment and adjust the following to add a disk cache directory.</div><div><strong>cache_mem 96 MB</strong></div><div><strong>cache_swap_low 90</strong></div><div><strong>cache_swap_high 95</strong></div><div>cache_dir ufs /<strong><span style="color:#FF0000;line-height:21px;">tmp/squid</span></strong> 100 16 256</div><div># Leave coredumps in the first cache dir</div><div>coredump_dir /var/spool/squid</div><div><br /></div><div># Add any of your own refresh_pattern entries above these.</div><div>refresh_pattern ^ftp:           1440    20%     10080</div><div>refresh_pattern ^gopher:        1440    0%      1440</div><div>refresh_pattern -i (/cgi-bin/|\?) 0     0%      0</div><div>refresh_pattern .               0       20%     4320</div><div><br /></div><div><span style="color:#FF0000;line-height:21px;"># 配置高匿，不允许设置任何多余头信息，保持原请求header。</span></div><div><strong>request_header_access Via deny all</strong></div><div><strong>request_header_access X-Forwarded-For deny all</strong></div><div><br /></div><div><br /></div></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">关键词：ssh shell无密码登录 忽略登录提示 yum静默安装 yum默认允许 yum默认yes</div><div></div></div>