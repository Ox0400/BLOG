---
layout: post
title: "[原创]python&amp;nbsp;mysql-connec-"
date: 2017-03-20 14:47:55
image: '/assets/img/'
description: ""
tags:
    - 
categories:
    - python
---



<div id="sina_keyword_ad_area2" class="articalContent newfont_family">Python操作mysql包有MySQLdb、SQLAlchemy等等、还有一个是mysql.connector，mysql官方包，详见（<a href="http://dev.mysql.com/doc/connector-python/en/index.html">MySQL Connector/Python Developer Guide</a>）。<div>用法官方有示例：<a href="http://dev.mysql.com/doc/connector-python/en/connector-python-examples.html">Chapter 5 Connector/Python CodingExamples</a></div><div><br /></div><div><dl><dt style="border:0px;vertical-align:baseline;font-weight:bold;font-family:Helvetica, Arial, sans-serif;line-height:21.6000003814697px;"><span style="border:0px;vertical-align:baseline;background:transparent;"><a href="http://dev.mysql.com/doc/connector-python/en/connector-python-example-connecting.html">5.1 Connecting to MySQL Using Connector/Python</a></span></dt><dt style="border:0px;vertical-align:baseline;font-weight:bold;font-family:Helvetica, Arial, sans-serif;line-height:21.6000003814697px;"><span style="border:0px;vertical-align:baseline;background:transparent;"><a href="http://dev.mysql.com/doc/connector-python/en/connector-python-example-ddl.html">5.2 Creating Tables Using Connector/Python</a></span></dt><dt style="border:0px;vertical-align:baseline;font-weight:bold;font-family:Helvetica, Arial, sans-serif;line-height:21.6000003814697px;"><span style="border:0px;vertical-align:baseline;background:transparent;"><a href="http://dev.mysql.com/doc/connector-python/en/connector-python-example-cursor-transaction.html">5.3 Inserting Data Using Connector/Python</a></span></dt><dt style="border:0px;vertical-align:baseline;font-weight:bold;font-family:Helvetica, Arial, sans-serif;line-height:21.6000003814697px;"><span style="border:0px;vertical-align:baseline;background:transparent;"><a href="http://dev.mysql.com/doc/connector-python/en/connector-python-example-cursor-select.html">5.4 Querying Data Using Connector/Python</a></span></dt></dl></div><div><br /></div>安装方法：<strong>easy_install mysql-connector-python</strong><div><br /></div><div><span style="line-height:21px;">用法和MySQLdb基本类似，这应该是类似一种协议的东西吧？</span></div><div>查询的时候是支持查询字典的！</div><div>connor.connect(*args, **kwargs)</div><div>cursor = conn.cursor(dictionary=True)</div><div><br /></div><div>附加是我自己写的mysql_helper.py</div><div><br /></div><pre class="python"> 1 # -*- coding: utf8 -*-
 2 # @author: 'zhangzhipeng'
 3 # @date: '2015-04-10'
 4
 5 import logging
 6
 7 import mysql.connector as connor
 8
 9
10 connor.connect()
11
12
13 class MysqlHelper(object):
14     """host="localhost", db="", user="root", passwd="", port=3306, pool_sizer=30, pool_name="mysql", commit_size=1"""
15     commit_count = 0
16
17     def __init__(self, *args, **kwargs):
18         commit_size = kwargs.get("commit_size", -1)
19         if commit_size &gt; -1:
20             self._commit_size = commit_size
21             del kwargs["commit_size"]
22         else:
23             self._commit_size = 1
24         self._last_row_id = None
25         self._conn = connor.connect(*args, **kwargs)
26
27     def insert(self, sql, params=None):
28         cursor = self._create_cursor()
29         try:
30             cursor.execute(sql, params)
31         except Exception, e:
32             try:
33                 logging.error("Mysql Call error. SQL = %s, params = %s, Error.msg=%s" % (sql, str(params).encode("utf8"), e))
34             except:
35                 print sql, params, e
36         self._last_row_id = cursor.lastrowid
37         self._commit()
38         return cursor.rowcount
39
40     def update(self, sql, params=None):
41         return self.insert(sql, params)
42
43     def delete(self, sql, params=None):
44         return self.insert(sql, params)
45
46     def select(self, sql, params=None):
47         cursor = self._create_cursor()
48         cursor.execute(sql, params)
49         return cursor.fetchall()
50
51     def commit(self):
52         try:
53             self._conn.commit()
54         except connor.Error, msg:
55             logging.error("Mysql commit error. message:%s." % msg)
56
57     @property
58     def last_row_id(self):
59         return self._last_row_id
60
61     def _create_cursor(self):
62         # cursor = conn.cursor(cursor_class=conner.cursor.MySQLCursorDict)
63         cursor = self._conn.cursor(dictionary=True)
64         return cursor
65
66     def _commit(self):
67         self.__class__.commit_count += 1
68         if self.__class__.commit_count == self._commit_size:
69             self.commit()
70             self.__class__.commit_count = 0
71
72     def __del__(self):
73         print "mysql close ..."
74         self.commit()
75         self._conn.close()
76
77
78 if __name__ == "__main__":
79     mysql_helper = MysqlHelper(host="localhost", db="zentao", user="root", passwd="kaimen", port=3306, pool_size=2,
80                                pool_name="mysql", commit_size=2)
81     print 1, mysql_helper.select("show tables;")
82     print 2, mysql_helper.select("show tables;")
83     print 3, mysql_helper.select("show tables;")
84     print 4, mysql_helper.select("show tables;")
85     print 5, mysql_helper.select("select * from task;")</pre><div>select 结果是list[dict{}, dict{}] </div><div>查询的时候，参数可以是列表、字典</div><div>user = {"uid": 20, "name":"zhipeng", "titles":"python,spider"}</div><div><div>sql = 'INSERT INTO users(uid, name, titles) VALUES (%s, %s,%s);'</div><div><span style="font-family:monospace;line-height:21px;">mysql_helper</span>.insert(sql,(<span style="line-height:21px;">user</span>["uid"],<span style="line-height:21px;">user</span>["name"],<span style="line-height:21px;">user</span>["titles"], ))</div></div><div><br /></div><div>或者：</div><div><span style="line-height:21px;">sql = 'INSERT INTO users(uid,name, titles) VALUES (%(uid)s, %(name)s, %(titles)s);'</span></div><div><span style="font-family:monospace;">mysql_helper.</span><span style="line-height:21px;">insert(sql, user</span><span style="line-height:21px;">)</span></div><div><span style="line-height:21px;"><br /></span></div><div><span style="line-height:21px;">增、删、改，返回的结果是几行受影响。</span></div><div>mysql_helper.last_row_id 获取最后添加的自增长列id</div><div><br /></div><div>commit_size 是设置主动commit方式，插入多少次数据后执行commit方法。</div><div><br /></div><div>在__del__中添加主动commit，确保数据提交更改。</div></div>