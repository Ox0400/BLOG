---
layout: post
title: "[原创]python-urllib-requests-httplib-ValueError：-Invalid-header-name"
date: 2017-03-20 14:48:51
image: '/assets/img/'
description: ""
tags:
    - 
categories:
    - python
---



<div id="sina_keyword_ad_area2" class="articalContent newfont_family"><span style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">用python做代理程序时，header key中如果含有:会导致异常：ValueError： Invalid header name</span><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">可以查看源码 Python27\Lib\httplib.py</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">如果不知道路径，可以打开python终端，</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><div>&gt;&gt;&gt; import httplib as h</div><div>&gt;&gt;&gt; h</div><div>module 'httplib' from 'c:\Python27\lib\httplib.pyc'</div><div>&gt;&gt;&gt;</div></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">这样知道路径了。</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">httplib.py 第1026行</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><div>1025     if not _is_legal_header_name(header):</div><div>1026         raise ValueError('Invalid header name %r' % (header,))</div></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">是一个<span style="line-height:21px;">_is_legal_header_name的函数对header做检查了</span></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">vim 中输入"<strong>#</strong>" 查找只函数定义位置 </div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">247    _is_legal_header_name = re.compile(r'\A[^:\s][^:\r\n]*\Z').match</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">原来是一个正则匹配</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">这就好办了。</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">解决办法，在python项目中，这样写</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><div>import re</div><div>import httplib</div></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">#httplib._is_legal_header_name = re.compile(<span style="color:#FF0000;line-height:21px;">r'\A[^:\s][^:\r\n]*\Z'</span>).match</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">httplib._is_legal_header_name = re.compile(<strong><span style="color:#04FF00;line-height:21px;">r'\A[^\s][^\r\n]*\Z')</span></strong>.match</div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);"><br /></div><div style="color:rgb(192,189,187);font-family:'Microsoft YaHei', 'Helvetica Neue', SimSun;font-size:14px;text-align:left;background-color:rgb(0,0,0);">搞定~</div><div></div></div>