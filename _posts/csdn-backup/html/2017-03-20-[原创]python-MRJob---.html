---
layout: post
title: "[原创]python-MRJob---"
date: 2017-03-20 14:47:02
image: '/assets/img/'
description: ""
tags:
    - 
categories:
    - python
---



<div id="sina_keyword_ad_area2" class="articalContent   newfont_family">
			安装方式：easy_install mrjob
<div><br /></DIV>
<div>使用方法：<br />
<div>
<div STYLE="box-sizing: border-box; padding: 20px 35px 20px; text-align: justify; outline: none !important;">
<div STYLE="font-size: 18px; box-sizing: border-box; outline: none !important;">
</DIV>
<div STYLE="font-size: 18px; box-sizing: border-box; outline: none !important;">
</DIV>
<div STYLE="box-sizing: border-box; outline: none !important;">
<pre STYLE="box-sizing: border-box; padding: 10px 20px; margin-top: 0px; margin-bottom: 1.1em; word-break: break-word; word-wrap: break-word; border: 0px; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; border-radius: 5px; text-align: start; outline: none !important; background-color: rgba(128, 128, 128, 0.0470588);">

<code STYLE="font-size: inherit; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; line-height: 1.45; box-sizing: border-box; padding: 0.5em; border-radius: 0px; display: block; outline: none !important; background-image: initial; background-attachment: initial; background-color: transparent !important; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span STYLE="box-sizing: border-box; color: rgb(136, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">#!-*- coding: utf8 -*-</SPAN></CODE><code STYLE="box-sizing: border-box; padding: 0.5em; border-radius: 0px; display: block; outline: none !important; background-image: initial; background-attachment: initial; background-color: transparent !important; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; white-space: pre-wrap; color: rgb(0, 136, 0);">"这段代码是使用</SPAN><font COLOR="#008800" FACE="source Code pro, monospace"><span STYLE="font-size: 13.5px; line-height: 19.5750007629395px; white-space: pre-wrap;">MapReduce进行分词统计！</SPAN></FONT><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; white-space: pre-wrap; color: rgb(0, 136, 0); background-color: transparent;">"</SPAN></CODE><code STYLE="font-size: inherit; white-space: pre-wrap; font-family: 'source Code pro', monospace; line-height: 1.45; box-sizing: border-box; padding: 0.5em; border-radius: 0px; display: block; outline: none !important; background-image: initial; background-attachment: initial; background-color: transparent !important; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span STYLE="color: rgb(0, 0, 136); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">import</SPAN><span STYLE="color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> re
</SPAN><span STYLE="color: rgb(0, 0, 136); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">import</SPAN><span STYLE="color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> sys
</SPAN><span STYLE="color: rgb(0, 0, 136); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">import</SPAN><span STYLE="color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> jieba

</SPAN><span STYLE="color: rgb(0, 0, 136); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">from</SPAN><span STYLE="color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> mrjob.job </SPAN><span STYLE="color: rgb(0, 0, 136); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">import</SPAN><span STYLE="color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> MRJob

word_re = re.compile(</SPAN><span STYLE="color: rgb(0, 136, 0); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">u"[\u4E00-\u9FA5]+"</SPAN><span STYLE="color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">)


</SPAN><span STYLE="color: rgb(0, 0, 0); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;"><span STYLE="box-sizing: border-box; outline: none !important; color: rgb(0, 0, 136);">class</SPAN> <span STYLE="box-sizing: border-box; outline: none !important; color: rgb(102, 0, 102);">TestMrJob</SPAN><span STYLE="box-sizing: border-box; outline: none !important; color: rgb(102, 0, 102);">(MRJob)</SPAN>:</SPAN><span STYLE="color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">
    </SPAN><span STYLE="color: rgb(0, 0, 0); box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;"><span STYLE="box-sizing: border-box; outline: none !important; color: rgb(0, 0, 136);">def</SPAN> <span STYLE="box-sizing: border-box; outline: none !important;">mapper</SPAN><span STYLE="box-sizing: border-box; outline: none !important; color: rgb(102, 0, 102);">(self, _, line)</SPAN>:</SPAN></CODE><code STYLE="font-size: inherit; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; line-height: 1.45; box-sizing: border-box; padding: 0.5em; border-radius: 0px; display: block; outline: none !important; background-image: initial; background-attachment: initial; background-color: transparent !important; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">        </SPAN><span STYLE="color: rgb(0, 136, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">"统计每行"</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">
        </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 0, 136); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">for</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> word </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 0, 136); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">in</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> word_re.findall(line.decode(</SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 136, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">"utf8"</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">)):
            </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 0, 136); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">for</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> new_word </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 0, 136); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">in</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> jieba.cut(word):
                </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 0, 136); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">yield</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> new_word.lower(), </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 102, 102); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">1</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">

    </SPAN><span STYLE="box-sizing: border-box; font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;"><span STYLE="box-sizing: border-box; outline: none !important; color: rgb(0, 0, 136);">def</SPAN> <span STYLE="box-sizing: border-box; outline: none !important;">reducer</SPAN><span STYLE="box-sizing: border-box; outline: none !important; color: rgb(102, 0, 102);">(self, word, counts)</SPAN>:</SPAN></CODE><code STYLE="font-size: inherit; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; line-height: 1.45; box-sizing: border-box; padding: 0.5em; border-radius: 0px; display: block; outline: none !important; background-image: initial; background-attachment: initial; background-color: transparent !important; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span STYLE="color: rgb(0, 136, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">        "统计结果"</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">
        </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 0, 136); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">yield</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> word, sum(counts)


</SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 0, 136); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">if</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;"> __name__ == </SPAN><span STYLE="box-sizing: border-box; color: rgb(0, 136, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px; outline: none !important;">'__main__'</SPAN><span STYLE="font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">:</SPAN></CODE><code STYLE="font-size: inherit; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: 'source Code pro', monospace; line-height: 1.45; box-sizing: border-box; padding: 0.5em; border-radius: 0px; display: block; outline: none !important; background-image: initial; background-attachment: initial; background-color: transparent !important; background-size: initial; background-origin: initial; background-clip: initial; background-position: initial; background-repeat: initial;"><span STYLE="color: rgb(136, 0, 0); font-family: 'source Code pro', monospace; font-size: 13.5px; line-height: 19.5750007629395px;">   #此处注意：</SPAN></CODE><span STYLE="font-size: 13.5px; white-space: pre-wrap; font-family: 'source Code pro', monospace; line-height: 19.5750007629395px;">    data = TestMrJob.run()
    #sys.argv.append(</SPAN><span STYLE="font-size: 13.5px; white-space: pre-wrap; box-sizing: border-box; color: rgb(0, 136, 0); font-family: 'source Code pro', monospace; line-height: 19.5750007629395px; outline: none !important;">"data/2"</SPAN><span STYLE="font-size: 13.5px; white-space: pre-wrap; font-family: 'source Code pro', monospace; line-height: 19.5750007629395px;">)
    #TestMrJob.run()
    </SPAN>
</PRE>
<pre STYLE="box-sizing: border-box; padding: 10px 20px; margin-top: 0px; margin-bottom: 1.1em; word-break: break-word; word-wrap: break-word; border: 0px; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; border-radius: 5px; text-align: start; outline: none !important; background-color: rgba(128, 128, 128, 0.0470588);">

<font FACE="Source Code Pro, monospace"><span STYLE="font-size: 13.5px; white-space: pre-wrap; line-height: 19.5750007629395px;">python test-mrjob.py data/2  &gt; tmp<br />
python test-mrjob.py data/*  &gt; tmp</SPAN></FONT>
</PRE>
<pre STYLE="box-sizing: border-box; padding: 10px 20px; margin-top: 0px; margin-bottom: 1.1em; word-break: break-word; word-wrap: break-word; border: 0px; border-image-source: initial; border-image-slice: initial; border-image-width: initial; border-image-outset: initial; border-image-repeat: initial; border-radius: 5px; text-align: start; outline: none !important; background-color: rgba(128, 128, 128, 0.0470588);">

奇怪的是，tmp文件中的结果是这样子的....<br />
<a HREF="http://ww4.sinaimg.cn/mw1024/83dc494djw1eqnuzmpq9dj20tg0ii0vw.jpg" TARGET="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src ="http://ww4.sinaimg.cn/mw1024/83dc494djw1eqnuzmpq9dj20tg0ii0vw.jpg" WIDTH="1024" HEIGHT="643" NAME="image_operate_62501427706000312"  ALT="【原创】python&nbsp;<wbr>MRJob&nbsp;<wbr>-&nbsp;<wbr>hadoop&nbsp;<wbr>MapReduce"  TITLE="【原创】python&nbsp;<wbr>MRJob&nbsp;<wbr>-&nbsp;<wbr>hadoop&nbsp;<wbr>MapReduce" /></A><br />
<br />
碉堡了...<br />
-
</PRE></DIV>
</DIV>
</DIV>
</DIV>							
		</div>